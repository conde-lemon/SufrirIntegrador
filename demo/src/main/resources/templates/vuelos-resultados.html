<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Vuelos</title>
    <link rel="stylesheet" th:href="@{/css/header_style.css}">
    <link rel="stylesheet" th:href="@{/css/index1_style.css}">
</head>
<body>
<div th:replace="~{fragments/header :: main-header}"></div>

<div class="container">

    <!-- ================================================== -->
    <!-- NUEVO: Buscador integrado en la página de resultados -->
    <!-- ================================================== -->
    <section class="search-section">
        <h2 class="search-title">Busca otro vuelo</h2>
        <form class="search-form" th:action="@{/vuelos/buscar}" method="GET">
            <div class="form-group">
                <label class="form-label" for="select-from">Desde:</label>
                <select class="form-select" id="select-from" name="origen" required>
                    <option value="">Selecciona un origen</option>
                    <option value="Peru">Perú</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Brasil">Brasil</option>
                    <option value="Chile">Chile</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Mexico">México</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="select-to">Hacia:</label>
                <select class="form-select" id="select-to" name="destino" required>
                    <option value="">Selecciona un destino</option>
                    <option value="Peru">Perú</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Brasil">Brasil</option>
                    <option value="Chile">Chile</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Mexico">México</option>
                    <option value="Espana">España</option>
                    <option value="Francia">Francia</option>
                    <option value="Italia">Italia</option>
                </select>
            </div>
            <div class="form-group-full">
                <button type="submit" class="search-flight-btn">Buscar Vuelos</button>
            </div>
        </form>
    </section>

    <hr style="margin: 40px 0;">

    <div class="results-header">
        <h2 class="section-title">Resultados para:
            <span th:text="${origen}">Origen</span> → <span th:text="${destino}">Destino</span>
        </h2>
    </div>

    <!-- ================================================== -->
    <!-- SECCIÓN DE RESULTADOS O SUGERENCIAS -->
    <!-- ================================================== -->

    <!-- Caso 1: Se encontraron vuelos -->
    <div class="packages-grid" th:if="${!vuelos.isEmpty()}">
        <!-- Iteramos sobre cada vuelo encontrado -->
        <article class="package-card" th:each="vuelo : ${vuelos}">
            <div class="package-content">
                <h3 class="package-title" th:text="${vuelo.nombre}">Nombre del Vuelo</h3>
                <p class="package-provider" th:text="${vuelo.proveedor.nombre}">Aerolínea</p>
                <p class="package-description" th:text="${vuelo.descripcion}">Descripción del vuelo.</p>
                <div class="package-tags" th:if="${vuelo.tags != null and !vuelo.tags.isEmpty()}">
                    <span th:each="tag : ${vuelo.tags.split(',')}" class="package-tag" th:text="${tag}">etiqueta</span>
                </div>
                <div class="package-footer">
                    <span class="package-price" th:text="'S/ ' + ${#numbers.formatDecimal(vuelo.precioBase, 1, 'COMMA', 2, 'POINT')}">$0.00</span>
                    <a th:href="@{/reservar/servicio/{id}(id=${vuelo.idServicio})}" class="reserve-btn">Reservar</a>
                </div>
            </div>
        </article>
    </div>

    <!-- Caso 2: No se encontraron vuelos, mostrar sugerencias -->
    <div th:if="${vuelos.isEmpty()}">
        <div class="alert-info">
            <p>Lo sentimos, no se encontraron vuelos para la ruta seleccionada.</p>
        </div>

        <!-- Mostramos la sección de sugerencias si existe -->
        <div class="suggestions-section" th:if="${sugerencias != null and !sugerencias.isEmpty()}">
            <h3 class="section-title" style="margin-top: 40px; text-align: left;">Quizás te interese...</h3>
            <div class="packages-grid">
                <!-- Iteramos sobre las sugerencias usando la misma tarjeta -->
                <article class="package-card" th:each="sugerencia : ${sugerencias}">
                    <div class="package-content">
                        <h3 class="package-title" th:text="${sugerencia.nombre}">Nombre del Vuelo</h3>
                        <p class="package-provider" th:text="${sugerencia.proveedor.nombre}">Aerolínea</p>
                        <p class="package-description" th:text="${sugerencia.descripcion}">Descripción del vuelo.</p>
                        <div class="package-tags" th:if="${sugerencia.tags != null and !sugerencia.tags.isEmpty()}">
                            <span th:each="tag : ${sugerencia.tags.split(',')}" class="package-tag" th:text="${tag}">etiqueta</span>
                        </div>
                        <div class="package-footer">
                            <span class="package-price" th:text="'S/ ' + ${#numbers.formatDecimal(sugerencia.precioBase, 1, 'COMMA', 2, 'POINT')}">$0.00</span>
                            <a th:href="@{/reservar/servicio/{id}(id=${sugerencia.idServicio})}" class="reserve-btn">Reservar</a>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </div>

</div>
</body>
</html>