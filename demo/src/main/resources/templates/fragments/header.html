<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
</head>
<body>

<!-- Fragment: Main Header -->
<header class="main-header" th:fragment="main-header">
    <div class="header-container">
        <!-- Logo -->
        <a href="/" class="logo">
            <div class="logo-icon">✈</div>
            <span>Travel4U</span>
        </a>

        <!-- Botón hamburguesa (móvil) -->
        <button class="hamburger-btn" id="btn-navbar" aria-label="Menú">
            <div class="hamburger-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>

        <!-- Navegación principal -->
        <nav class="main-nav" id="id_ul_navbar">
            <ul class="nav-links">
                <li><a href="/" class="nav-link active">Inicio</a></li>
                <li><a href="#" class="nav-link" data-tipo="VUELO">Vuelos</a></li>
                <li><a href="#" class="nav-link" data-tipo="CRUCERO">Cruceros</a></li>
                <li><a href="#" class="nav-link" data-tipo="BUS">Buses</a></li>

                <!-- Opciones de usuario autenticado -->
                <li sec:authorize="isAuthenticated()"><a href="/reservas" class="nav-link">Mis Reservas</a></li>
                <li sec:authorize="isAuthenticated()"><a href="/perfil" class="nav-link">Mi Perfil</a></li>
            </ul>

            <!-- Usuario autenticado - Botón de cerrar sesión -->
            <div class="user-info" sec:authorize="isAuthenticated()">
                <span class="user-name" sec:authentication="name">Usuario</span>
                <a href="/logout" class="btn-logout">Cerrar Sesión</a>
            </div>

            <!-- Botones de autenticación (no autenticado) -->
            <div class="auth-buttons" sec:authorize="!isAuthenticated()">
                <a href="/login" class="btn-login">Iniciar Sesión</a>
                <a href="/registrar" class="btn-register">Registrarse</a>
            </div>
        </nav>
    </div>
</header>

<!-- JavaScript para el header -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Toggle menú hamburguesa
    const btnNavbar = document.getElementById('btn-navbar');
    const mainNav = document.getElementById('id_ul_navbar');

    if (btnNavbar && mainNav) {
        const newBtnNavbar = btnNavbar.cloneNode(true);
        btnNavbar.parentNode.replaceChild(newBtnNavbar, btnNavbar);

        newBtnNavbar.addEventListener('click', (e) => {
            e.stopPropagation();
            newBtnNavbar.classList.toggle('active');
            mainNav.classList.toggle('active');

            if (window.innerWidth <= 768) {
                document.body.style.overflow = mainNav.classList.contains('active') ? 'hidden' : 'auto';
            }
        });

        const navLinks = mainNav.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    newBtnNavbar.classList.remove('active');
                    mainNav.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
        });
    }

    // Marcar enlace activo según la URL
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link');

    navLinks.forEach(link => {
        const href = link.getAttribute('href');
        link.classList.remove('active');

        if (href === currentPath || (currentPath === '/' && href === '/')) {
            link.classList.add('active');
        }
    });

    // Integración con el formulario de búsqueda
    const categoryItems = document.querySelectorAll('.nav-link[data-tipo]');
    const serviceTypeInput = document.getElementById('service-type');
    const searchTitle = document.getElementById('search-title');
    const searchBtn = document.getElementById('search-service-btn');

    if (categoryItems.length > 0 && serviceTypeInput) {
        const serviceConfig = {
            'VUELO': { title: 'Busca tu próximo vuelo', button: 'Buscar Vuelos' },
            'CRUCERO': { title: 'Busca tu próximo crucero', button: 'Buscar Cruceros' },
            'BUS': { title: 'Busca tu próximo bus', button: 'Buscar Buses' }
        };

        categoryItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();

                const searchSection = document.querySelector('.search-section');
                if (searchSection) {
                    searchSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }

                const tipo = item.dataset.tipo;
                const config = serviceConfig[tipo];

                if (config) {
                    serviceTypeInput.value = tipo;
                    if (searchTitle) searchTitle.textContent = config.title;
                    if (searchBtn) searchBtn.textContent = config.button;

                    document.querySelectorAll('.category-item').forEach(cat => {
                        cat.classList.remove('active');
                        if (cat.dataset.tipo === tipo) {
                            cat.classList.add('active');
                        }
                    });
                }
            });
        });
    }

    // Restaurar scroll al cambiar tamaño de ventana
    window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
            document.body.style.overflow = 'auto';
            if (mainNav) mainNav.classList.remove('active');
            const hamburger = document.getElementById('btn-navbar');
            if (hamburger) hamburger.classList.remove('active');
        }
    });
});
</script>

</body>
</html>

