<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thyme.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista Previa - Boleta de Reserva</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <style>
        body { background-color: #eef1f5; }
        .boleta-container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }
        .header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 2rem;
        }
        .section-title {
            margin-top: 1.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            border-left: 5px solid #2575fc;
            padding-left: .7rem;
        }
        .info-box {
            background: #f8f9fa;
            padding: 1rem;
            border-left: 4px solid #2575fc;
            border-radius: 8px;
        }
        .detalle-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-top: 1.2rem;
            padding: 1.2rem;
            background: #fbfbfb;
        }
        .detalle-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: .5rem;
            margin-bottom: 1rem;
        }
        .total-section {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            padding: 1.6rem;
            text-align: right;
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
        }
        @media print {
            .no-print { display: none; }
            body { background: white; }
        }
    </style>
</head>

<body>

<div class="boleta-container">

    <!-- Botones -->
    <div class="p-3 text-center no-print">
        <a th:href="@{/reservas/lista}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Volver
        </a>

        <a th:href="@{/boleta/reserva/{id}/pdf(id=${reserva.idReserva})}"
           target="_blank"
           class="btn btn-danger">
            <i class="fas fa-file-pdf"></i> Descargar PDF
        </a>

        <button onclick="window.print()" class="btn btn-primary">
            <i class="fas fa-print"></i> Imprimir
        </button>
    </div>

    <!-- Header -->
    <div class="header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="fw-bold m-0">Travel4U</h1>
                <p class="m-0">Boleta de Viaje</p>
            </div>

            <h4 class="fw-bold"># TFU-<span th:text="${reserva.idReserva}"></span></h4>
        </div>

        <div class="d-flex justify-content-between mt-4">
            <div>
                <strong>Fecha de emisión:</strong><br>
                <span th:text="${#temporals.format(#temporals.createNow(),'dd/MM/yyyy HH:mm')}"></span>
            </div>

            <div class="text-end">
                <strong>Estado:</strong><br>
                <span class="badge bg-success"
                      th:text="${reserva.estado}"></span>
            </div>
        </div>
    </div>

    <div class="p-4">

        <!-- Información del Cliente -->
        <h5 class="section-title"><i class="fas fa-user"></i> Información del Cliente</h5>

        <div class="row g-3">
            <div class="col-md-6">
                <div class="info-box">
                    <strong>Nombre:</strong>
                    <span th:text="${reserva.usuario.nombres + ' ' + reserva.usuario.apellidos}"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="info-box">
                    <strong>Email:</strong>
                    <span th:text="${reserva.usuario.email}"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="info-box">
                    <strong>Fecha de reserva:</strong>
                    <span th:text="${#temporals.format(reserva.createdAt,'dd/MM/yyyy HH:mm')}"></span>
                </div>
            </div>

            <div class="col-md-6">
                <div class="info-box">
                    <strong>Moneda:</strong>
                    <span th:text="${reserva.moneda}"></span>
                </div>
            </div>
        </div>

        <!-- Detalles -->
        <h5 class="section-title mt-4">
            <i class="fas fa-file-invoice"></i> Detalles de la Reserva
        </h5>

        <!-- Iteración de Detalle_Reserva -->
        <div th:each="detalle, idx : ${reserva.detalleReservas}" class="detalle-card">

            <div class="detalle-title">
                Servicio [[${idx.count}]]:
                <span th:text="${detalle.servicio.nombre}"></span>
                <span class="badge bg-primary ms-2" th:text="${detalle.servicio.tipoServicio}"></span>
            </div>

            <div class="row">

                <!-- Datos del pasajero -->
                <div class="col-md-6">
                    <h6 class="fw-bold"><i class="fas fa-user-check"></i> Pasajero</h6>

                    <p><strong>Nombre:</strong> <span th:text="${detalle.nombre}"></span></p>
                    <p><strong>Apellido:</strong> <span th:text="${detalle.apellido}"></span></p>
                    <p><strong>Documento:</strong> <span th:text="${detalle.documento}"></span></p>
                    <p><strong>Fecha nacimiento:</strong>
                        <span th:text="${#temporals.format(detalle.fechaNacimiento,'dd/MM/yyyy')}"></span>
                    </p>
                    <p><strong>Sexo:</strong> <span th:text="${detalle.sexo}"></span></p>
                    <p><strong>Correo:</strong> <span th:text="${detalle.correo}"></span></p>
                    <p><strong>Teléfono:</strong> <span th:text="${detalle.telefono}"></span></p>
                    <p><strong>Asiento Seleccionado:</strong> <span th:text="${detalle.asientoSeleccionado}"></span></p>

                </div>

                <!-- Datos del Servicio -->
                <div class="col-md-6">
                    <h6 class="fw-bold"><i class="fas fa-briefcase"></i> Datos del Servicio</h6>

                    <p><strong>Tipo:</strong> <span th:text="${detalle.servicio.tipoServicio}"></span></p>
                    <p><strong>Descripción:</strong> <span th:text="${detalle.servicio.descripcion}"></span></p>
                    <p><strong>Origen:</strong> <span th:text="${detalle.servicio.origen}"></span></p>
                    <p><strong>Destino:</strong> <span th:text="${detalle.servicio.destino}"></span></p>
                    <p><strong>Tags:</strong> <span th:text="${detalle.servicio.tags}"></span></p>

                    <p><strong>Fecha salida:</strong>
                        <span th:text="${#temporals.format(detalle.fechaSalida,'dd/MM/yyyy')}"></span>
                    </p>

                    <p><strong>Hora salida:</strong> <span th:text="${detalle.horaSalida}"></span></p>

                    <p><strong>Puerta de Abordaje:</strong> <span th:text="${detalle.puertaAbordaje}"></span></p>
                </div>
            </div>

            <hr>

            <div class="row text-end">
                <p>
                    <strong>Cantidad:</strong> <span th:text="${detalle.cantidad}"></span> |
                    <strong>Precio Unitario:</strong> <span th:text="${detalle.precioUnitario}"></span> |
                    <strong>Subtotal:</strong> <span th:text="${detalle.subtotal}"></span>
                </p>
            </div>
        </div>

        <!-- Observaciones -->
        <div th:if="${reserva.observaciones}" class="mt-4">
            <h5 class="section-title"><i class="fas fa-comment"></i> Observaciones</h5>
            <p class="fst-italic" th:text="${reserva.observaciones}"></p>
        </div>

    </div>

    <!-- Total -->
    <div class="total-section">
        TOTAL:
        <span th:text="${reserva.moneda + ' ' + reserva.total}"></span>
    </div>

</div>

</body>
</html>
