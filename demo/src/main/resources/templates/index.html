<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel For U - Inicio</title>

    <!-- Tus estilos existentes -->
    <link rel="stylesheet" th:href="@{/css/header_style.css}">
    <link rel="stylesheet" th:href="@{/css/index1_style.css}">

    <!-- NUEVO: Estilo para las tarjetas de oferta -->
    <link rel="stylesheet" th:href="@{/css/paquetes_style.css}">
</head>

<body>
<!-- 1. Encabezado reutilizable -->
<div th:replace="~{fragments/header :: main-header}"></div>

<!-- Contenedor principal -->
<div class="container">

    <!-- 2. Sección de Búsqueda (Corregida para funcionar con Spring) -->
    <section class="search-section">
        <h2 class="search-title">Busca tu próximo vuelo</h2>
        <!-- FORMULARIO CORREGIDO: apunta a un endpoint del controlador y usa 'name' en los inputs -->
        <form class="search-form" th:action="@{/vuelos/buscar}" method="get">
            <div class="form-group">
                <label class="form-label" for="select-from">Desde:</label>
                <!-- AÑADIDO: id y una opción por defecto con valor vacío -->
                <select class="form-select" id="select-from">
                    <option value="">Selecciona un origen</option>
                    <option value="Peru">Perú</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Brasil">Brasil</option>
                    <option value="Chile">Chile</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Mexico">México</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="select-to">Hacia:</label>
                <!-- AÑADIDO: id y una opción por defecto con valor vacío -->
                <select class="form-select" id="select-to">
                    <option value="">Selecciona un destino</option>
                    <option value="Peru">Perú</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Brasil">Brasil</option>
                    <option value="Chile">Chile</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Mexico">México</option>
                    <option value="Espana">España</option>
                    <option value="Francia">Francia</option>
                    <option value="Italia">Italia</option>
                </select>
            </div>
            <!-- AÑADIDO: Botón de búsqueda que aparecerá dinámicamente -->
            <div class="form-group-full">
                <button type="button" id="search-flight-btn" class="search-flight-btn hidden">Buscar Vuelos</button>
            </div>
        </form>
    </section>

    <!-- 3. NUEVA SECCIÓN: Ofertas del Web Scraper -->
    <section class="packages-section">
        <h2 class="section-title">Ofertas y Paquetes Destacados</h2>
        <div th:if="${ofertas == null || ofertas.isEmpty()}">
            <p style="text-align: center; color: #666;">No se encontraron ofertas en este momento. ¡Intenta más tarde!</p>
        </div>
        <div class="packages-grid" th:if="${!ofertas.isEmpty()}">
            <!-- Iteramos sobre la lista de 'ofertas' del scraper -->
            <a th:each="oferta : ${ofertas}" th:href="@{${oferta.urlDestino}}" class="package-card-link">
                <article class="package-card">
                    <!-- onerror: si la imagen del scraper falla, muestra una imagen local de respaldo -->
                    <img th:src="${oferta.imagenUrl}" alt="Imagen de oferta" class="package-image" onerror="this.onerror=null;this.src='/img/placeholder.jpg';">
                    <div class="package-content">
                        <h3 class="package-title" th:text="${oferta.titulo}">Título de la Oferta</h3>
                        <p class="package-description" th:text="${oferta.descripcion}">Descripción...</p>
                        <div class="package-footer">
                            <div class="package-tags">
                                <span class="package-tag" th:classappend="${oferta.tagClass}" th:text="${oferta.tag}">Tag</span>
                            </div>
                            <span class="package-price" th:text="${oferta.precio}">S/ 0.00</span>
                        </div>
                    </div>
                </article>
            </a>
        </div>
    </section>

    <hr style="margin: 40px 0;">

    <!-- 4. SECCIÓN DE RESERVAS RECIENTES (Mantenida como se solicitó) -->
    <!-- =================================================================================================
         ADVERTENCIA DE SEGURIDAD: Mostrar datos de todos los usuarios (incluyendo nombres) en una página
         pública es un riesgo de privacidad muy grave. Esta sección debería mostrar solo las reservas del
         usuario autenticado en una página de perfil/dashboard, o ser eliminada de la página de inicio.
         ================================================================================================== -->
    <section class="reservations-section">
        <h2 class="section-title">Reservas Recientes</h2>
        <div class="packages-grid" th:if="${!reservas.isEmpty()}">
            <article class="package-card" th:each="reserva : ${reservas}">
                <div class="package-content">
                    <h3 class="package-title" th:text="'Reserva #' + ${reserva.idReserva}">Reserva #123</h3>
                    <p class="package-description">
                        <strong>Cliente:</strong> <span th:text="${reserva.usuario.nombres} + ' ' + ${reserva.usuario.apellidos}"></span><br>
                        <strong>Fecha:</strong> <span th:text="${#temporals.format(reserva.createdAt, 'dd/MM/yyyy HH:mm')}"></span><br>
                        <strong>Estado:</strong> <span th:text="${reserva.estado}" class="package-tag">CONFIRMADA</span>
                    </p>
                    <div class="package-tags">
                        <span class="package-price" th:text="'S/ ' + ${#numbers.formatDecimal(reserva.total, 1, 'COMMA', 2, 'POINT')}">S/ 100.00</span>
                    </div>
                </div>
            </article>
        </div>
        <div th:if="${reservas.isEmpty()}" class="alert alert-info">
            No se encontraron reservas en la base de datos.
        </div>
    </section>

</div>

<!-- El script js.js ya no es necesario para el formulario, pero se mantiene por si tiene otras funciones -->
<script th:src="@{/js/js.js}"></script>

</body>
</html>